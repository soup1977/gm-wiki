{% extends "base.html" %}
{% block title %}{{ faction.name }} â€” The War Table{% endblock %}

{% block content %}
<nav aria-label="breadcrumb" class="mb-3">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{{ url_for('factions.list_factions') }}">Factions</a></li>
        <li class="breadcrumb-item active">{{ faction.name }}</li>
    </ol>
</nav>

<div class="d-flex justify-content-between align-items-start mb-4">
    <div>
        <h2>{{ faction.name }}</h2>
        <span class="badge bg-{{ disposition_colors.get(faction.disposition, 'secondary') }}">
            {{ faction.disposition | capitalize if faction.disposition else 'Unknown' }}
        </span>
    </div>
    <div class="d-flex gap-2">
        <a href="{{ url_for('factions.edit_faction', faction_id=faction.id) }}" class="btn btn-secondary">
            <i class="bi bi-pencil"></i> Edit
        </a>
        <form method="POST"
              action="{{ url_for('factions.delete_faction', faction_id=faction.id) }}"
              onsubmit="return confirm('Delete faction \'{{ faction.name }}\'? This will unlink all associated NPCs, locations, and quests.')">
            <button type="submit" class="btn btn-outline-danger">
                <i class="bi bi-trash"></i>
            </button>
        </form>
    </div>
</div>

{% if faction.description %}
<div class="mb-4">
    <h5>Description</h5>
    <div>{{ faction.description | md | safe }}</div>
</div>
{% endif %}

{% if faction.gm_notes %}
<div class="mb-4 p-3 border border-warning rounded">
    <h5 class="text-warning"><i class="bi bi-eye-slash me-1"></i> GM Notes</h5>
    <div>{{ faction.gm_notes | md | safe }}</div>
</div>
{% endif %}

<div class="row g-4 mt-1">

    {# Member NPCs #}
    <div class="col-md-4">
        <h6 class="text-muted text-uppercase small mb-2"><i class="bi bi-person me-1"></i>Member NPCs</h6>
        {% if faction.npcs %}
        <div class="d-flex flex-wrap gap-2">
            {% for npc in faction.npcs | sort(attribute='name') %}
            <a href="{{ url_for('npcs.npc_detail', npc_id=npc.id) }}"
               class="badge bg-secondary text-decoration-none fs-6">{{ npc.name }}</a>
            {% endfor %}
        </div>
        {% else %}
        <p class="text-muted small">No NPCs linked. Edit an NPC and select this faction.</p>
        {% endif %}
    </div>

    {# Controlled Locations #}
    <div class="col-md-4">
        <h6 class="text-muted text-uppercase small mb-2"><i class="bi bi-geo-alt me-1"></i>Controlled Locations</h6>
        {% if faction.locations %}
        <div class="d-flex flex-wrap gap-2">
            {% for loc in faction.locations | sort(attribute='name') %}
            <a href="{{ url_for('locations.location_detail', location_id=loc.id) }}"
               class="badge bg-secondary text-decoration-none fs-6">{{ loc.name }}</a>
            {% endfor %}
        </div>
        {% else %}
        <p class="text-muted small">No locations linked. Edit a location and select this faction.</p>
        {% endif %}
    </div>

    {# Faction Quests #}
    <div class="col-md-4">
        <h6 class="text-muted text-uppercase small mb-2"><i class="bi bi-flag me-1"></i>Faction Quests</h6>
        {% if faction.quests %}
        <div class="d-flex flex-wrap gap-2">
            {% for quest in faction.quests | sort(attribute='name') %}
            <a href="{{ url_for('quests.quest_detail', quest_id=quest.id) }}"
               class="badge bg-secondary text-decoration-none fs-6">{{ quest.name }}</a>
            {% endfor %}
        </div>
        {% else %}
        <p class="text-muted small">No quests linked. Edit a quest and select this faction.</p>
        {% endif %}
    </div>

</div>
{% endblock %}
