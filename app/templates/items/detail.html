{% extends "base.html" %}
{% block title %}{{ item.name }} â€” GM Wiki{% endblock %}

{% block content %}
<nav aria-label="breadcrumb" class="mb-3">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{{ url_for('items.list_items') }}">Items</a></li>
        <li class="breadcrumb-item active">{{ item.name }}</li>
    </ol>
</nav>

<div class="d-flex justify-content-between align-items-start mb-4">
    <div>
        <h2>{{ item.name }}</h2>
        <p class="text-muted small mb-1">
            Campaign: <a href="{{ url_for('campaigns.campaign_detail', campaign_id=item.campaign.id) }}">{{ item.campaign.name }}</a>
        </p>
        <div class="d-flex gap-2 mt-1">
            {% if item.type %}
                <span class="badge bg-secondary">{{ item.type }}</span>
            {% endif %}
            {% if item.rarity %}
                {% if item.rarity == 'common' %}
                    <span class="badge bg-secondary">{{ item.rarity | title }}</span>
                {% elif item.rarity == 'uncommon' %}
                    <span class="badge bg-success">{{ item.rarity | title }}</span>
                {% elif item.rarity == 'rare' %}
                    <span class="badge bg-primary">{{ item.rarity | title }}</span>
                {% elif item.rarity == 'very rare' %}
                    <span class="badge bg-info text-dark">{{ item.rarity | title }}</span>
                {% elif item.rarity == 'legendary' %}
                    <span class="badge bg-warning text-dark">{{ item.rarity | title }}</span>
                {% elif item.rarity == 'unique' %}
                    <span class="badge bg-danger">{{ item.rarity | title }}</span>
                {% else %}
                    <span class="badge bg-secondary">{{ item.rarity | title }}</span>
                {% endif %}
            {% endif %}
        </div>
    </div>
    <div class="d-flex gap-2">
        <a href="{{ url_for('items.edit_item', item_id=item.id) }}" class="btn btn-secondary">
            <i class="bi bi-pencil"></i> Edit
        </a>
        <form method="POST" action="{{ url_for('items.delete_item', item_id=item.id) }}"
              onsubmit="return confirm('Delete item \'{{ item.name }}\'? This cannot be undone.')">
            <button type="submit" class="btn btn-danger">
                <i class="bi bi-trash"></i> Delete
            </button>
        </form>
    </div>
</div>

<div class="row g-4">
    <!-- Main info -->
    <div class="col-md-8">
        {% if item.description %}
        <div class="mb-4">
            <h5 class="text-secondary">Description</h5>
            <div>{{ item.description | md | safe }}</div>
        </div>
        {% endif %}

        {% if item.gm_notes %}
        <div class="mb-4 p-3 border border-warning rounded">
            <h5 class="text-warning"><i class="bi bi-eye-slash"></i> GM Notes</h5>
            <div class="mb-0">{{ item.gm_notes | md | safe }}</div>
        </div>
        {% endif %}
    </div>

    <!-- Sidebar -->
    <div class="col-md-4">
        <div class="card bg-dark border-secondary mb-3">
            <div class="card-header">Owner</div>
            <div class="card-body">
                {% if item.owner_npc %}
                    <a href="{{ url_for('npcs.npc_detail', npc_id=item.owner_npc.id) }}">{{ item.owner_npc.name }}</a>
                {% else %}
                    <span class="text-muted">Party</span>
                {% endif %}
            </div>
        </div>

        <div class="card bg-dark border-secondary">
            <div class="card-header">Origin Location</div>
            <div class="card-body">
                {% if item.origin_location %}
                    <a href="{{ url_for('locations.location_detail', location_id=item.origin_location.id) }}">{{ item.origin_location.name }}</a>
                {% else %}
                    <span class="text-muted">Unknown</span>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
